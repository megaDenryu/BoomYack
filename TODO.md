# ObjectGraph機能 開発TODOリスト

## 📊 プロジェクト現状分析

### ✅ 完成済み
- **基本値オブジェクト層**: ID型、座標系、数値・サイズ値オブジェクト
- **グラフモデル層**: ノードモデル、エッジモデルの基本構造
- **座標変換システム**: 3つの座標系（画面座標、描画座標、図形内座標）の相互変換
- **グラフVM標準**: 座標系ごとのノード・エッジVM実装とファクトリー

### 🚧 部分実装済み
- **基本グラフVM**: 実行時の描画用VMクラス（座標変換機能不足）

### ❌ 未実装
- **UIコンポーネント層**: 付箋、矢印、ハンドル等の実際のUI要素
- **レイアウトエンジン**: 自動配置・レイアウト計算機能  
- **描画・レンダリング**: Canvas/SVGでの実際の描画処理
- **ユーザーインタラクション**: ドラッグ、クリック、拡縮操作
- **データ永続化**: JSON入出力、保存・読込機能

---

## 🎯 開発優先順位

### Phase 1: 基盤アーキテクチャの完成 (高優先度)

#### 1.1 グラフモデル層の拡張
- [ ] **グラフモデル**クラスの実装
  - ノード群・エッジ群の管理
  - モデル操作API（追加・削除・更新）
  - 標準VMへの変換機能
- [ ] **メタ情報**クラスの実装
  - グラフ名、説明、作成日時等の管理
  - JSON出力時のメタデータ生成

#### 1.2 レイアウトエンジンの実装
- [ ] **自動レイアウトエンジン**の基本実装
  - グラフモデルから標準VMへの自動配置
  - 基本的なレイアウトアルゴリズム（階層・格子・力学モデル）
  - レイアウト設定の管理
- [ ] **標準グラフVM**の集約クラス実装
  - ノードVM標準群・エッジVM標準群の管理
  - 実行時グラフVMへの変換機能
  
#### 1.3 座標変換・描画システムの完成
- [ ] **ボード変換**クラスの実装
  - 拡縮・オフセット変換の管理
  - 座標点変換の統一API
- [ ] **アフィン適用器**の実装
  - 標準VM → 実行時VMの変換処理
  - 描画時の座標変換
- [ ] **実行時グラフVM**の拡張
  - 画面座標でのノード・エッジ管理
  - 描画用データの提供
- [ ] **一時アフィン状態**の実装  
  - ドラッグ中・拡縮中の状態管理
  - プレビュー表示用データの保持

### Phase 2: UI要素の実装 (中優先度)

#### 2.1 基本図形コンポーネントの作成
- [ ] **付箋UIコンポーネント**の実装
  - LV2UIComponentBaseを継承
  - テキスト編集機能
  - 4辺・4頂点のリサイズハンドル
  - 矢印召喚点の配置
- [ ] **矢印UIコンポーネント**の実装  
  - 直線矢印の描画
  - 始点・終点ノードとの接続
  - 折れ線矢印の実装（将来拡張）
- [ ] **ハンドルUIコンポーネント**の実装
  - リサイズハンドル（辺・頂点）
  - 矢印召喚点
  - ホバー効果とマウスカーソル変更

#### 2.2 描画システムの実装  
- [ ] **拡縮ラッパ**の実装
  - DOM要素のCSS transform制御
  - 拡縮・位置変更の適用
  - アニメーション対応
- [ ] **描画コンテナ**の実装
  - Canvas/SVG描画領域の管理
  - UIコンポーネントの配置・管理
  - 座標系とDOM要素の同期

### Phase 3: インタラクション機能 (中優先度)

#### 3.1 基本操作の実装
- [ ] **ノード作成システム**
  - 右クリック長押し → 円形メニュー表示
  - ドラッグによるノード種別選択
  - ノード配置とモデル更新
- [ ] **ノード削除システム**
  - 左クリック → コンテキストメニュー
  - Deleteキーによる削除
  - エッジの連動削除
- [ ] **移動・ドラッグシステム**
  - ノードのドラッグ移動
  - リアルタイム座標更新
  - 複数選択・移動

#### 3.2 拡縮・パン操作の実装
- [ ] **スクロール拡縮システム**
  - ホイールイベントでの拡縮
  - 拡縮中心点の計算
  - 全要素の一括座標更新
- [ ] **パン操作システム**
  - 画面ドラッグでの移動
  - 描画基準座標の更新
  - スムーズなアニメーション

### Phase 4: データ管理・永続化 (中優先度)

#### 4.1 JSON入出力システム
- [ ] **グラフモデル → JSON**
  - シリアライゼーション機能
  - メタデータの含有
  - バージョン管理対応
- [ ] **JSON → グラフモデル**
  - デシリアライゼーション機能
  - バリデーション機能
  - エラーハンドリング
- [ ] **標準グラフVM ⇔ JSON**
  - レイアウト情報の保存・読込
  - 表示状態の永続化

#### 4.2 外部出力機能
- [ ] **CSV出力機能**
  - ノード一覧のCSV出力
  - エッジ関係のCSV出力
  - AI学習用データ形式対応
- [ ] **外部API連携**
  - AI（ChatGPT等）への入力形式生成
  - カスタム出力フォーマット対応

### Phase 5: 高度なUI機能 (低優先度)

#### 5.1 エディター機能の拡張
- [ ] **テキスト編集強化**
  - リッチテキスト対応
  - 複数行テキストの自動サイズ調整
  - テキスト検索・置換
- [ ] **ノード種別システム**  
  - カスタムノードタイプの定義
  - プロパティスキーマの管理
  - 入力フォームの自動生成
- [ ] **高度なエッジ機能**
  - 複雑な折れ線エッジ
  - エッジのスタイル設定
  - 条件付きエッジの表示

#### 5.2 UX向上機能
- [ ] **アニメーション強化**
  - 滑らかな拡縮・移動
  - 要素追加・削除のアニメーション
  - ホバー・選択状態の視覚フィードバック
- [ ] **パフォーマンス最適化**
  - 大規模グラフの表示最適化
  - 仮想化・遅延描画
  - メモリ使用量の最適化

---

## 🚀 次のアクションプラン

### 即座に開始すべき作業

1. **グラフモデルクラスの実装** 
   - `基本オブジェクト/グラフモデル.ts`にグラフモデルクラスを追加
   - ノード・エッジの集約管理機能を実装

2. **簡単なレイアウトエンジンの実装**
   - `基本オブジェクト/`に`レイアウトエンジン.ts`を作成
   - 格子状の基本レイアウト機能を実装

3. **実行時グラフVMの拡張**
   - `基本オブジェクト/グラフVM.ts`に集約クラスを追加
   - 座標変換連携機能を実装

### 推奨開発順序

```
グラフモデル完成 → レイアウトエンジン → 実行時VM拡張 → 付箋UI → 描画システム → 操作システム
```

この順序で進めることで、各段階で動作確認を行いながら開発を進められます。

---

## 💡 技術的な考慮事項

### アーキテクチャ原則の維持
- **DDD**: Value Objectによる型安全性を継続
- **座標系分離**: 3つの座標系の責務分離を維持  
- **UIComponent設計**: 既存のLV1/LV2パターンに準拠
- **vanilla-extract**: CSSの型安全性を継続

### パフォーマンス要件
- 100ノード程度の中規模グラフでスムーズな動作
- リアルタイムな拡縮・移動操作
- メモリリーク対策（delete()メソッドの適切な実装）

### 将来拡張性
- プラグイン可能なノードタイプシステム
- レイアウトアルゴリズムの切り替え対応
- 外部ツールとの連携API