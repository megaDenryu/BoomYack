# 03_配置物層

付箋・矢印系の具体的な配置オブジェクトを定義します。集約パターンでViewとVMを分離し、ノードVMラップクラスと結合しています。

```mermaid
classDiagram
    direction RL
    %% ========== 配置物インターフェース群 ==========
    class I付箋集約 {
        <<interface>>
        +view: I付箋View
        +vm: I付箋VM
    }
    
    class I付箋VM {
        <<interface>>
    }
    
    class I付箋View {
        <<interface>>
    }
    
    class Iまっすぐ矢印集約 {
        <<interface>>
        +view: Iまっすぐ矢印View
        +vm: Iまっすぐ矢印VM
    }
    
    class Iまっすぐ矢印VM {
        <<interface>>
    }
    
    class Iまっすぐ矢印View {
        <<interface>>
    }
    
    class Iなめらか曲線矢印集約 {
        <<interface>>
        +view: Iなめらか曲線矢印View
        +vm: Iなめらか曲線矢印VM
    }
    
    class Iなめらか曲線矢印VM {
        <<interface>>
    }
    
    class Iなめらか曲線矢印View {
        <<interface>>
    }
    
    class I折れ線矢印集約 {
        <<interface>>
        +view: I折れ線矢印View
        +vm: I折れ線矢印VM
    }
    
    class I折れ線矢印VM {
        <<interface>>
    }
    
    class I折れ線矢印View {
        <<interface>>
    }
    
    %% ========== 付箋実装クラス群 ==========
    class 付箋VM {
        +配置物ID: 配置物ID
        +配置物種別: '付箋'
        +constructor(id: 配置物ID)
    }
    
    class 付箋View {
        #_componentRoot: DivC
        +constructor()
        #createComponentRoot(): DivC
        +コンテンツ設定(text: string): void
        +背景色変更(color: string): void
        +表示状態切り替え(): void
    }
    
    class 付箋集約 {
        +view: I付箋View
        +vm: ノードVM標準描画座標と見なせる<付箋VM>
        +constructor(ノードVM標準: ノードVM標準描画座標)
        +位置取得(): 描画座標点
        +位置設定(位置: 描画座標点): void
        +サイズ取得(): サイズ
        +サイズ設定(サイズ: サイズ): void
    }
    
    %% ========== まっすぐ矢印実装クラス群 ==========
    class まっすぐ矢印VM {
        +配置物ID: 配置物ID
        +配置物種別: 'まっすぐ矢印'
        +線の太さ: number
        +線の色: string
        +constructor(id: 配置物ID)
        +線スタイル設定(太さ: number, 色: string): void
    }
    
    class まっすぐ矢印View {
        #_componentRoot: SvgC
        +constructor()
        #createComponentRoot(): SvgC
        +矢印描画(開始点: 描画座標点, 終了点: 描画座標点): void
        +スタイル更新(太さ: number, 色: string): void
    }
    
    class まっすぐ矢印集約 {
        +view: Iまっすぐ矢印View
        +vm: エッジVM標準描画座標と見なせる<まっすぐ矢印VM>
        +constructor(エッジVM標準: エッジVM標準描画座標)
        +開始点取得(): 描画座標点
        +終了点取得(): 描画座標点
        +矢印更新(): void
    }
    
    %% ========== なめらか曲線矢印実装クラス群 ==========
    class なめらか曲線矢印VM {
        +配置物ID: 配置物ID
        +配置物種別: 'なめらか曲線矢印'
        +制御点配列: 描画座標点[]
        +曲線の滑らかさ: number
        +constructor(id: 配置物ID)
        +制御点追加(点: 描画座標点): void
        +曲線パラメータ設定(滑らかさ: number): void
    }
    
    class なめらか曲線矢印View {
        #_componentRoot: SvgC
        +constructor()
        #createComponentRoot(): SvgC
        +ベジェ曲線描画(制御点配列: 描画座標点[]): void
        +曲線パラメータ更新(滑らかさ: number): void
    }
    
    class なめらか曲線矢印集約 {
        +view: Iなめらか曲線矢印View
        +vm: エッジVM標準描画座標と見なせる<なめらか曲線矢印VM>
        +constructor(エッジVM標準: エッジVM標準描画座標)
        +曲線ルート計算(): 描画座標点[]
        +曲線更新(): void
    }
    
    %% ========== 折れ線矢印実装クラス群 ==========
    class 折れ線矢印VM {
        +配置物ID: 配置物ID
        +配置物種別: '折れ線矢印'
        +中継点配列: 描画座標点[]
        +角の丸み: number
        +constructor(id: 配置物ID)
        +中継点追加(点: 描画座標点): void
        +角の丸み設定(radius: number): void
    }
    
    class 折れ線矢印View {
        #_componentRoot: SvgC
        +constructor()
        #createComponentRoot(): SvgC
        +折れ線描画(点配列: 描画座標点[], 丸み: number): void
        +パス更新(): void
    }
    
    class 折れ線矢印集約 {
        +view: I折れ線矢印View
        +vm: エッジVM標準描画座標と見なせる<折れ線矢印VM>
        +constructor(エッジVM標準: エッジVM標準描画座標)
        +折れ線ルート計算(): 描画座標点[]
        +折れ線更新(): void
    }
    
    %% ========== 関係性 ==========
    付箋VM ..|> I配置物 : 実装
    付箋VM ..|> I付箋VM : 実装
    付箋View ..|> I付箋View : 実装
    付箋集約 ..|> I付箋集約 : 実装
    
    まっすぐ矢印VM ..|> I配置物 : 実装
    まっすぐ矢印VM ..|> Iまっすぐ矢印VM : 実装
    まっすぐ矢印View ..|> Iまっすぐ矢印View : 実装
    まっすぐ矢印集約 ..|> Iまっすぐ矢印集約 : 実装
    
    なめらか曲線矢印VM ..|> I配置物 : 実装
    なめらか曲線矢印VM ..|> Iなめらか曲線矢印VM : 実装
    なめらか曲線矢印View ..|> Iなめらか曲線矢印View : 実装
    なめらか曲線矢印集約 ..|> Iなめらか曲線矢印集約 : 実装
    
    折れ線矢印VM ..|> I配置物 : 実装
    折れ線矢印VM ..|> I折れ線矢印VM : 実装
    折れ線矢印View ..|> I折れ線矢印View : 実装
    折れ線矢印集約 ..|> I折れ線矢印集約 : 実装
    
    %% 集約関係
    付箋集約 "1" --> "1" I付箋View : view
    付箋集約 "1" --> "1" 付箋VM : vm(ラップされている)
    
    まっすぐ矢印集約 "1" --> "1" Iまっすぐ矢印View : view
    まっすぐ矢印集約 "1" --> "1" まっすぐ矢印VM : vm(ラップされている)
    
    なめらか曲線矢印集約 "1" --> "1" Iなめらか曲線矢印View : view
    なめらか曲線矢印集約 "1" --> "1" なめらか曲線矢印VM : vm(ラップされている)
    
    折れ線矢印集約 "1" --> "1" I折れ線矢印View : view
    折れ線矢印集約 "1" --> "1" 折れ線矢印VM : vm(ラップされている)
    
    %% ViewはUIコンポーネントを継承
    付箋View --|> LV2UIComponentBase : 継承
    まっすぐ矢印View --|> LV2UIComponentBase : 継承
    なめらか曲線矢印View --|> LV2UIComponentBase : 継承
    折れ線矢印View --|> LV2UIComponentBase : 継承
```

## 説明

### 集約パターンの実装
- 各配置物はViewとVMを集約クラスで結合
- インターフェースによる型安全な抽象化
- 外部からはViewとVMに直接アクセスさせず、集約経由で操作

### ラップクラスとの結合
- 付箋はノードVMと結合（単一点に配置）
- 矢印系はエッジVMと結合（2点間を結ぶ）
- 「〜と見なせる」クラスでノード情報と配置物情報を統合

### View層のUIコンポーネント
- 付箋はDivCを使用したHTML要素
- 矢印系はSvgCを使用したSVG描画
- 各種スタイルやアニメーションをサポート

### VM層のビジネスロジック
- 各配置物固有の状態と振る舞いを管理
- I配置物インターフェースを実装して種別を明示
- 座標系に依存しない純粋なビジネスロジック

---
[← README に戻る](./README.md)